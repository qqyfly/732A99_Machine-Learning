---
title: "Ex3"
author: "Daniele Bozzoli"
date: "`r Sys.Date()`"
output: pdf_document
---

##### Ex 3

## 1)

```{r}
data <- read.csv("pima-indians-diabetes.csv")

age <- data[, 8]
plasma <- data[, 2]

names(data)[9] <- "diabetes"
names(data)[2] <- "plasma"
names(data)[8] <- "age"

x <- age
y <- plasma
df <- data.frame(x, y)

ggplot2::ggplot(df, ggplot2::aes(age, plasma)) +
  ggplot2::geom_point(ggplot2::aes(colour = data[, 9]))+
  ggplot2::labs(x = "Age", y="Plasma glucose")

```

We observe how a lot of people without diabete is highly concentrated in the lower 
part of the age axis, explaining how younger individuals tend to be non-diabetic,
on the other hand, we notice how especially people with higher plasma glucose 
concentration tend to be diabetic, less concentrated in a specific age group, more
spread across the x-age axis.

#### 2) and 3)

```{r}

model <- glm(diabetes ~ plasma + age, fam = binomial(link="logit"), data = data)
summary(model)

# r = 0.5

c1 <- fitted(model) >= .5

missC_error <- sum(data$diabetes != c1) / nrow(data)
cat("Misclassification error:", missC_error, "\n")

ggplot2::ggplot(df, ggplot2::aes(age, plasma)) +
  ggplot2::geom_point(ggplot2::aes(colour = c1))+
  ggplot2::labs(x = "Age", y="Plasma glucose")     # T = Diabetic, F = Non-diabetic

```
Looking at the graph, we notice how the classification is not very accurate. Though, it 
catches the fact that people with higher plasma glucose concentration are more 
commonly diabetic. We obtain a misclassification error = 0.266.

### 4)

```{r}

# r = 0.2

c2 <- fitted(model) >= .2

ggplot2::ggplot(df, ggplot2::aes(age, plasma)) +
  ggplot2::geom_point(ggplot2::aes(colour = c2))+
  ggplot2::labs(x = "Age", y="Plasma glucose")

# r = 0.8

c3 <- fitted(model) >= .8

ggplot2::ggplot(df, ggplot2::aes(age, plasma)) +
  ggplot2::geom_point(ggplot2::aes(colour = c3))+
  ggplot2::labs(x = "Age", y="Plasma glucose")

```
It looks like the line that splits the predicted observations into diabetic
and non diabetic into the two cases ( r= 0.2 and r=0.8) has the same slope, but
different intercept. Both cases are pretty bad predictors as 0.2 and 0.8 are
respectively too low and too high to get a good classification for our case.

### 5)

```{r}

# Adding new variables, logit function with r= 0.5

z1 <- data$plasma^4
z2 <- data$plasma^3 * data$age
z3 <- data$plasma^2 * data$age^2
z4 <- data$plasma^1 * data$age^3
z5 <- data$age^4

newdata <- cbind(data, z1, z2, z3, z4, z5)

newmodel <- glm(diabetes ~ plasma + age + z1 + z2 + z3 + z4 + z5 , family = binomial(link = "logit") , data = newdata)

summary(newmodel)

c4 <- fitted(newmodel) >= .5

new_missC_error <- sum(data$diabetes != c4) / nrow(data)
cat("Misclassification error:", new_missC_error, "\n")

ggplot2::ggplot(df, ggplot2::aes(age, plasma)) +
  ggplot2::geom_point(ggplot2::aes(colour = c4))+
  ggplot2::labs(x = "Age", y="Plasma glucose")

```
The outcome of this analysis is better than the first case, as we obtain a 
lower misclassification error than before, and also graphically we notice
how this version captures what we were saying in the first part of the 
analysis, how people with higher plasma glucose concentration are more 
exposed to the risk of having diabete. We also notice how we strangely get a 
misclassificated predicted value in the bottom right corner of the graph.
